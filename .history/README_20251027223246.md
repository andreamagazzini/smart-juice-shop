# Next.js Juice Shop ğŸ¹

An intentionally insecure web application for security training, built with Next.js, React, and TypeScript.

## Overview

This is a modern recreation of the OWASP Juice Shop for educational purposes, built with Next.js 16+ App Router. It demonstrates common web security vulnerabilities in a controlled environment perfect for security training courses.

## ğŸ¯ Purpose

This application is designed for:
- **Security Training**: Teaching students about common web vulnerabilities
- **Penetration Testing**: Practicing ethical hacking techniques
- **Code Review**: Understanding insecure coding patterns
- **Bug Bounties**: Learning how to identify and report vulnerabilities

## âš ï¸ Legal Disclaimer

**THIS APPLICATION IS INTENTIONALLY INSECURE AND SHOULD NEVER BE USED IN PRODUCTION.**

## ğŸš€ Getting Started

### Prerequisites

- Node.js 20+ 
- npm or yarn

### Installation

1. Clone the repository
```bash
git clone <your-repo-url>
cd nextjs-juice-shop
```

2. Install dependencies
```bash
npm install
```

3. Set up the database
```bash
# Generate Prisma Client
npm run db:generate

# Push schema to database
npm run db:push

# Seed the database (manual for now - see below)
```

4. Run the development server
```bash
npm run dev
```

5. Open [http://localhost:3000](http://localhost:3000)

## ğŸ—„ï¸ Database Setup

**No database required!** This app uses browser-based storage (IndexedDB) for simplicity.

### Session-Based Storage
- **Each browser = Separate user session**
- Data lives in browser only
- No interference between users
- Perfect for educational purposes

### Manage Your Data
Visit the Score Board page to:
- **ğŸ”„ Reset**: Clear all progress and start fresh
- **ğŸ“¥ Export**: Download your progress as JSON
- **ğŸ“¤ Import**: Load previously exported progress

Initial Credentials (for login challenges):
- **Admin**: admin@juice-shop.herokuapp.com / admin123
- **User**: user@juice-shop.herokuapp.com / password123

## ğŸ“ Available Challenges

### Broken Authentication (2 challenges)
- **Login Admin**: Log in with the admin account
- **Weak Password**: Exploit weak password policies

### SQL Injection (2 challenges)
- **SQL Injection Login**: Bypass authentication using SQL injection
- **SQL Injection Search**: Extract data via SQL injection in search

### XSS - Cross-Site Scripting (2 challenges)
- **Reflected XSS**: Execute reflected XSS attacks
- **Persisted XSS**: Store malicious scripts in feedback/comments

### Broken Access Control (2 challenges)
- **Access Admin Section**: Access admin features without authorization
- **Bypass Paywall**: Access premium features without paying

### Improper Input Validation (1 challenge)
- **Negative Order**: Place orders with negative values

## ğŸ—ï¸ Architecture

```
nextjs-juice-shop/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # API Routes (vulnerable endpoints)
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ login/route.ts    # SQL Injection vulnerability
â”‚   â”‚   â””â”€â”€ products/
â”‚   â”‚       â””â”€â”€ search/route.ts   # SQL Injection vulnerability
â”‚   â”œâ”€â”€ login/page.tsx            # Login page
â”‚   â”œâ”€â”€ score-board/page.tsx      # Challenge leaderboard
â”‚   â””â”€â”€ page.tsx                  # Home page with search
â”œâ”€â”€ components/                   # React components
â”‚   â”œâ”€â”€ Navigation.tsx
â”‚   â”œâ”€â”€ SearchBar.tsx
â”‚   â””â”€â”€ ChallengeNotification.tsx
â”œâ”€â”€ lib/                          # Utility libraries
â”‚   â”œâ”€â”€ db.ts                     # Database connection
â”‚   â”œâ”€â”€ auth.ts                   # Authentication (vulnerable)
â”‚   â”œâ”€â”€ security.ts               # Security utilities (vulnerable)
â”‚   â””â”€â”€ challenges.ts             # Challenge tracking
â””â”€â”€ prisma/
    â””â”€â”€ schema.prisma            # Database schema
```

## ğŸ”“ Implemented Vulnerabilities

### 1. SQL Injection
**Location**: `app/api/auth/login/route.ts`, `app/api/products/search/route.ts`

**Vulnerability**: Direct string concatenation in SQL queries
```typescript
const results = await prisma.$queryRawUnsafe(
  `SELECT * FROM User WHERE email = '${email}' AND password = '${password}'`
)
```

**Exploits**:
- Login bypass: `admin@juice-shop.herokuapp.com' OR '1'='1`
- Data extraction: Union-based SQL injection in search

### 2. Broken Authentication
**Location**: Password storage and JWT implementation

**Issues**:
- Passwords stored in plain text (for demo purposes)
- Weak JWT secret: `secret`
- Missing 2FA validation

### 3. Cross-Site Scripting (XSS)
**Location**: Search results rendering

**Issue**: User input rendered without sanitization

### 4. Broken Access Control
**Location**: JWT verification

**Issue**: Weak or missing authorization checks on admin endpoints

## ğŸ“Š Scoreboard System

Students can track their progress on the scoreboard page:
- View completed challenges
- See leaderboard rankings
- Track difficulty scores

## ğŸ“ For Instructors

### Setting Up the Course

1. **Deploy**: Host on Vercel, Netlify, or any Node.js host
2. **Database**: Use SQLite for simplicity or upgrade to PostgreSQL for production
3. **Students**: Have students register accounts (or provide test accounts)
4. **Scoring**: Track progress via the scoreboard

### Walkthroughs

Create walkthrough documentation for each challenge:
1. Challenge description
2. Vulnerability location
3. Step-by-step exploitation
4. Remediation techniques
5. OWASP Top 10 category reference

## ğŸ› ï¸ Development

### Adding New Challenges

1. Add challenge definition to `lib/challenges.ts`
2. Implement vulnerable endpoint in `app/api/`
3. Add challenge verification logic
4. Update leaderboard display

### Testing

```bash
# Run linter
npm run lint

# Type checking
npx tsc --noEmit
```

## ğŸ“ˆ Roadmap

- [ ] Add more XSS challenges (stored, reflected, DOM-based)
- [ ] Implement CSRF challenges
- [ ] Add file upload vulnerabilities
- [ ] Implement XXE challenges
- [ ] Add deserialization vulnerabilities
- [ ] Create vulnerable dependency challenges
- [ ] Add cryptocurrency/Web3 challenges
- [ ] Implement walkthrough tooltips

## ğŸš€ Deployment

### For Local Development (SQLite)
The app is currently set up to use SQLite (file-based database) for local development.

### For Production Deployment (Vercel)
Switch to PostgreSQL before deploying to Vercel. See deployment guides:

- **[QUICK_DEPLOY.md](QUICK_DEPLOY.md)** - Fast deployment guide
- **[DEPLOYMENT.md](DEPLOYMENT.md)** - Detailed deployment instructions

**Recommended database hosts:**
- **Supabase** (Free PostgreSQL) - Best for courses
- **Neon** (Serverless PostgreSQL)
- **Vercel Postgres** (Integrated with Vercel)

**Quick switch to PostgreSQL:**
```bash
# Edit prisma/schema.prisma: change "sqlite" to "postgresql"
npx prisma generate
npx prisma db push
```

## ğŸ¤ Contributing

This is an educational project. Feel free to:
- Report issues
- Suggest new challenges
- Submit pull requests
- Improve documentation

## ğŸ“ License

MIT License - Use responsibly for educational purposes only.

## ğŸ™ Acknowledgments

- Inspired by [OWASP Juice Shop](https://owasp.org/www-project-juice-shop/)
- Built with [Next.js](https://nextjs.org/)
- Database managed with [Prisma](https://www.prisma.io/)

## âš ï¸ Security Notice

**DO NOT DEPLOY THIS APPLICATION TO PRODUCTION OR EXPOSE IT TO THE INTERNET WITHOUT PROPER ISOLATION.**

This application contains numerous security vulnerabilities intentionally included for educational purposes.
